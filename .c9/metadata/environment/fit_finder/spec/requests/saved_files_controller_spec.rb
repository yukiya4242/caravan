{"filter":false,"title":"saved_files_controller_spec.rb","tooltip":"/fit_finder/spec/requests/saved_files_controller_spec.rb","undoManager":{"mark":11,"position":11,"stack":[[{"start":{"row":0,"column":0},"end":{"row":36,"column":0},"action":"insert","lines":["require 'rails_helper'","","RSpec.describe SavedFilesController, type: :request do","  let(:user) { create(:user) }","  let(:chat) { create(:chat) }","","  before do","    sign_in user","  end","","  describe 'POST #create' do","    context 'when user is authenticated' do","      it 'saves the chat' do","        expect {","          post \"/saved_files\", params: { chat_id: chat.id }, xhr: true","        }.to change(user.saved_files, :count).by(1)","","        expect(response).to have_http_status(:ok)  # response should be 'OK' because we're using Ajax","      end","    end","","    context 'when user is not authenticated' do","      before do","        sign_out user","      end","","      it 'does not allow the user to save the chat' do","        expect {","          post \"/saved_files\", params: { chat_id: chat.id }, xhr: true","        }.not_to change(user.saved_files, :count)","","        expect(response).to have_http_status(:unauthorized)  # response should be 'unauthorized' because user is not signed in","      end","    end","  end","end",""],"id":1}],[{"start":{"row":21,"column":3},"end":{"row":33,"column":7},"action":"remove","lines":[" context 'when user is not authenticated' do","      before do","        sign_out user","      end","","      it 'does not allow the user to save the chat' do","        expect {","          post \"/saved_files\", params: { chat_id: chat.id }, xhr: true","        }.not_to change(user.saved_files, :count)","","        expect(response).to have_http_status(:unauthorized)  # response should be 'unauthorized' because user is not signed in","      end","    end"],"id":2},{"start":{"row":21,"column":3},"end":{"row":35,"column":0},"action":"insert","lines":["context 'when user is not authenticated' do","  it 'does not allow the user to save the chat' do","    sign_out user","","    new_user = create(:user)  # 新しいユーザーを作成する","","    expect {","      sign_in new_user  # 新しいユーザーでサインインする","      post \"/saved_files\", params: { chat_id: chat.id }, xhr: true","    }.not_to change(new_user.saved_files, :count)","","    expect(response).to have_http_status(:unauthorized)","  end","end",""]}],[{"start":{"row":21,"column":0},"end":{"row":21,"column":2},"action":"insert","lines":["  "],"id":3},{"start":{"row":22,"column":0},"end":{"row":22,"column":2},"action":"insert","lines":["  "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"insert","lines":["  "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":2},"action":"insert","lines":["  "]},{"start":{"row":26,"column":0},"end":{"row":26,"column":2},"action":"insert","lines":["  "]},{"start":{"row":27,"column":0},"end":{"row":27,"column":2},"action":"insert","lines":["  "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":2},"action":"insert","lines":["  "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":2},"action":"insert","lines":["  "]},{"start":{"row":30,"column":0},"end":{"row":30,"column":2},"action":"insert","lines":["  "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":2},"action":"insert","lines":["  "]},{"start":{"row":32,"column":0},"end":{"row":32,"column":2},"action":"insert","lines":["  "]},{"start":{"row":33,"column":0},"end":{"row":33,"column":2},"action":"insert","lines":["  "]},{"start":{"row":34,"column":0},"end":{"row":34,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":21,"column":0},"end":{"row":21,"column":2},"action":"insert","lines":["  "],"id":4},{"start":{"row":22,"column":0},"end":{"row":22,"column":2},"action":"insert","lines":["  "]},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"insert","lines":["  "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":2},"action":"insert","lines":["  "]},{"start":{"row":26,"column":0},"end":{"row":26,"column":2},"action":"insert","lines":["  "]},{"start":{"row":27,"column":0},"end":{"row":27,"column":2},"action":"insert","lines":["  "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":2},"action":"insert","lines":["  "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":2},"action":"insert","lines":["  "]},{"start":{"row":30,"column":0},"end":{"row":30,"column":2},"action":"insert","lines":["  "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":2},"action":"insert","lines":["  "]},{"start":{"row":32,"column":0},"end":{"row":32,"column":2},"action":"insert","lines":["  "]},{"start":{"row":33,"column":0},"end":{"row":33,"column":2},"action":"insert","lines":["  "]},{"start":{"row":34,"column":0},"end":{"row":34,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":34,"column":7},"end":{"row":35,"column":0},"action":"remove","lines":["",""],"id":5}],[{"start":{"row":24,"column":0},"end":{"row":24,"column":4},"action":"remove","lines":["    "],"id":6},{"start":{"row":26,"column":0},"end":{"row":26,"column":4},"action":"remove","lines":["    "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":4},"action":"remove","lines":["    "]}],[{"start":{"row":21,"column":7},"end":{"row":34,"column":7},"action":"remove","lines":["context 'when user is not authenticated' do","      it 'does not allow the user to save the chat' do","        sign_out user","","        new_user = create(:user)  # 新しいユーザーを作成する","","        expect {","          sign_in new_user  # 新しいユーザーでサインインする","          post \"/saved_files\", params: { chat_id: chat.id }, xhr: true","        }.not_to change(new_user.saved_files, :count)","","        expect(response).to have_http_status(:unauthorized)","      end","    end"],"id":7},{"start":{"row":21,"column":7},"end":{"row":32,"column":0},"action":"insert","lines":["context 'when user is not authenticated' do","  it 'does not allow the user to save the chat' do","    sign_out user","","    expect {","      post \"/saved_files\", params: { chat_id: chat.id }, xhr: true","    }.not_to change(SavedFile, :count)  # SavedFileの数を数える","","    expect(response).to have_http_status(:unauthorized)","  end","end",""]}],[{"start":{"row":22,"column":0},"end":{"row":22,"column":2},"action":"insert","lines":["  "],"id":8},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"insert","lines":["  "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":2},"action":"insert","lines":["  "]},{"start":{"row":26,"column":0},"end":{"row":26,"column":2},"action":"insert","lines":["  "]},{"start":{"row":27,"column":0},"end":{"row":27,"column":2},"action":"insert","lines":["  "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":2},"action":"insert","lines":["  "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":2},"action":"insert","lines":["  "]},{"start":{"row":30,"column":0},"end":{"row":30,"column":2},"action":"insert","lines":["  "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":22,"column":0},"end":{"row":22,"column":2},"action":"insert","lines":["  "],"id":9},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"insert","lines":["  "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":2},"action":"insert","lines":["  "]},{"start":{"row":26,"column":0},"end":{"row":26,"column":2},"action":"insert","lines":["  "]},{"start":{"row":27,"column":0},"end":{"row":27,"column":2},"action":"insert","lines":["  "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":2},"action":"insert","lines":["  "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":2},"action":"insert","lines":["  "]},{"start":{"row":30,"column":0},"end":{"row":30,"column":2},"action":"insert","lines":["  "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":22,"column":0},"end":{"row":22,"column":2},"action":"insert","lines":["  "],"id":10},{"start":{"row":23,"column":0},"end":{"row":23,"column":2},"action":"insert","lines":["  "]},{"start":{"row":24,"column":0},"end":{"row":24,"column":2},"action":"insert","lines":["  "]},{"start":{"row":25,"column":0},"end":{"row":25,"column":2},"action":"insert","lines":["  "]},{"start":{"row":26,"column":0},"end":{"row":26,"column":2},"action":"insert","lines":["  "]},{"start":{"row":27,"column":0},"end":{"row":27,"column":2},"action":"insert","lines":["  "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":2},"action":"insert","lines":["  "]},{"start":{"row":29,"column":0},"end":{"row":29,"column":2},"action":"insert","lines":["  "]},{"start":{"row":30,"column":0},"end":{"row":30,"column":2},"action":"insert","lines":["  "]},{"start":{"row":31,"column":0},"end":{"row":31,"column":2},"action":"insert","lines":["  "]}],[{"start":{"row":31,"column":9},"end":{"row":32,"column":0},"action":"remove","lines":["",""],"id":11}],[{"start":{"row":24,"column":0},"end":{"row":24,"column":6},"action":"remove","lines":["      "],"id":12},{"start":{"row":28,"column":0},"end":{"row":28,"column":6},"action":"remove","lines":["      "]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":13,"column":16},"end":{"row":13,"column":16},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1684911656102,"hash":"084495f91dc8a51dadba2da650bcaf47be1d637d"}